<dashboard version="2" theme="dark" hiddenElements="{&quot;hideEdit&quot;:false,&quot;hideOpenInSearch&quot;:false,&quot;hideExport&quot;:false}">
    <label>Pihole Overview</label>
    <description></description>
    <definition>
        <![CDATA[{"visualizations":{"viz_single_1":{"type":"splunk.singlevalue","options":{"colorMode":"block","drilldown":"none","sparklineDisplay":"off","trendDisplay":"absolute","underLabel":"Total Queries vs Yesterday","backgroundColor":"> majorValue | rangeValue(convertedColorRange)"},"dataSources":{"primary":"ds_search_4"},"showProgressBar":true,"title":"# of Queries vs Yesterday","context":{"convertedColorRange":[{"from":0,"value":"#53a051"},{"to":0,"value":"#53a051"}]}},"viz_single_2":{"type":"splunk.singlevalue","options":{"colorMode":"block","sparklineDisplay":"off","trendDisplay":"absolute","underLabel":"% Queries Blocked vs Yesterday","unit":"%","shouldUseThousandSeparators":false,"drilldown":"none","backgroundColor":"> majorValue | rangeValue(convertedColorRange)"},"dataSources":{"primary":"ds_search_5"},"showProgressBar":true,"title":"% Queries Blocked vs Yesterday","context":{"convertedColorRange":[{"from":100,"value":"#3C444D"},{"from":70,"to":100,"value":"#3C444D"},{"from":30,"to":70,"value":"#3C444D"},{"from":0,"to":30,"value":"#dc4e41"},{"to":0,"value":"#dc4e41"}]}},"viz_single_3":{"type":"splunk.singlevalue","options":{"colorMode":"block","drilldown":"all","underLabel":"Total Clients","backgroundColor":"> majorValue | rangeValue(convertedColorRange)"},"dataSources":{"primary":"ds_search_6"},"eventHandlers":[{"type":"drilldown.customUrl","options":{"url":"search?q=%7C%20from%20datamodel:Network_Resolution.DNS%20%20%0A%7C%20search%20sourcetype=pihole%0A%7C%20top%20src&earliest=$global_time_tok.earliest$&latest=$global_time_tok.latest$","newTab":true}}],"title":"# of Clients","context":{"convertedColorRange":[{"from":100,"value":"#3C444D"},{"from":70,"to":100,"value":"#3C444D"},{"from":30,"to":70,"value":"#3C444D"},{"from":0,"to":30,"value":"#006d9c"},{"to":0,"value":"#006d9c"}]}},"viz_chart_1":{"type":"splunk.column","dataSources":{"primary":"ds_search_9"},"showProgressBar":true,"title":"DNS Queries Today vs Month Average","options":{"yAxisAbbreviation":"auto","y2AxisAbbreviation":"auto","showRoundedY2AxisLabels":false,"legendTruncation":"ellipsisMiddle","showY2MajorGridLines":true,"xAxisLabelRotation":0,"xAxisTitleVisibility":"hide","yAxisTitleVisibility":"show","y2AxisTitleVisibility":"show","yAxisScale":"linear","showOverlayY2Axis":0,"y2AxisScale":"inherit","overlayFields":["\"Lower Predict\"","\"Upper Predict\"","\"Month Median\"","\"Month Mean\""],"dataValuesDisplay":"off","stackMode":"auto","showSplitSeries":0,"showIndependentYRanges":0,"legendDisplay":"right","lineWidth":2,"seriesColors":"[0xF3BF75,0xAF575A,0xEC9960,0x4FA484,0x006D9C]"},"context":{}},"viz_table_1":{"type":"splunk.table","options":{"drilldown":"cell"},"dataSources":{"primary":"ds_search_10"},"eventHandlers":[{"type":"drilldown.linkToDashboard","options":{"app":"pihole_dns_app","dashboard":"pihole_dns_search","tokens":[{"token":"form.src","value":"$click.value$"}],"newTab":true}}],"title":"Top 10 Sources"},"viz_chart_2":{"type":"splunk.bar","dataSources":{"primary":"ds_search_11"},"title":"Top 10 Blocked Queries","options":{"yAxisAbbreviation":"off","y2AxisAbbreviation":"off","showRoundedY2AxisLabels":false,"legendTruncation":"ellipsisMiddle","showY2MajorGridLines":true,"xAxisTitleText":"Query","yAxisTitleText":"Query","yAxisTitleVisibility":"hide","yAxisScale":"linear","dataValuesDisplay":"all","stackMode":"stacked","showSplitSeries":0,"legendDisplay":"bottom","seriesColors":"[0x32617D,0xEDD051,0x62B3B2,0x738795,0x63282A]"},"context":{}}},"dataSources":{"ds_system_base":{"type":"ds.search","options":{"query":"`pihole_system_index` sourcetype=pihole:system\n| stats latest(domains_on_blocklist) as domains_on_blocklist, latest(gravity_updated) as gravity_updated by host","queryParameters":{"earliest":"$global_time_tok.earliest$","latest":"$global_time_tok.latest$"}},"name":"ds_system_base"},"ds_search_1":{"type":"ds.chain","options":{"query":"| fields host | head 1","extend":"ds_system_base"}},"ds_search_2":{"type":"ds.search","options":{"query":"| tstats count where `pihole_index` sourcetype=pihole by host","queryParameters":{"earliest":"$global_time_tok.earliest$","latest":"$global_time_tok.latest$"}},"name":"pihole_host_token"},"ds_search_3":{"type":"ds.search","options":{"query":"| tstats count where `pihole_system_index` sourcetype=pihole:system by host","queryParameters":{"earliest":"$global_time_tok.earliest$","latest":"$global_time_tok.latest$"}}},"ds_search_4":{"type":"ds.search","options":{"query":"| tstats `pihole_summariesonly` count from datamodel=Network_Resolution.DNS where host=\"$host_tok$\" sourcetype=pihole DNS.message_type=query earliest=-1d@d latest=-24h\n| append\n    [ tstats `pihole_summariesonly` count from datamodel=Network_Resolution.DNS where host=\"$host_tok$\" sourcetype=pihole DNS.message_type=query earliest=@d latest=now]\n| appendcols\n    [ makeresults\n    | eval time=now()]\n| rename time as _time","queryParameters":{"earliest":"$global_time_tok.earliest$","latest":"$global_time_tok.latest$"}},"name":"pihole_queries_vs_yesterday"},"ds_search_5":{"type":"ds.search","options":{"query":"| tstats `pihole_summariesonly` count from datamodel=Network_Resolution.DNS where host=\"$host_tok$\" sourcetype=pihole (DNS.reply_code=\"Query Refused\" OR DNS.message_type=query) earliest=-1d@d latest=-24h by DNS.message_type, DNS.reply_code\n| `drop_dm_object_name(DNS)`\n| stats sum(eval(if(reply_code==\"Query Refused\",'count',0))) as totalBlocked, sum(eval(if(message_type==\"Query\",'count',0))) as totalQueries\n| eval \"% Blocked\"=round(((totalBlocked)/totalQueries)*100,0)\n| fields \"% Blocked\"\n| append\n    [ tstats `pihole_summariesonly` count from datamodel=Network_Resolution.DNS where host=\"$host_tok$\" sourcetype=pihole (DNS.reply_code=\"Query Refused\" OR DNS.message_type=query) earliest=@d latest=now by DNS.message_type, DNS.reply_code\n    | `drop_dm_object_name(DNS)`\n    | stats sum(eval(if(reply_code==\"Query Refused\",'count',0))) as totalBlocked, sum(eval(if(message_type==\"Query\",'count',0))) as totalQueries\n    | eval \"% Blocked\"=round(((totalBlocked)/totalQueries)*100,0)\n    | fields \"% Blocked\"]\n| appendcols\n    [makeresults\n    | eval time=now()]\n| rename time as _time","queryParameters":{"earliest":"$global_time_tok.earliest$","latest":"$global_time_tok.latest$"}},"name":"pihole_queries_blocked_vs_yesterday"},"ds_search_6":{"type":"ds.search","options":{"query":"| tstats `pihole_summariesonly` dc(DNS.src) as \"Distinct Clients\" from datamodel=Network_Resolution.DNS where host=\"$host_tok$\" sourcetype=pihole","queryParameters":{"earliest":"$global_time_tok.earliest$","latest":"$global_time_tok.latest$"}},"name":"pihole_clients_overview"},"ds_search_7":{"type":"ds.chain","options":{"query":"| search $system_host_tok$\n| fields domains_on_blocklist","extend":"ds_system_base"}},"ds_search_8":{"type":"ds.chain","options":{"query":"| search $system_host_tok$\n|fields gravity_updated\n| convert timeformat=\"%b %d\" ctime(gravity_updated)","extend":"ds_system_base"}},"ds_search_9":{"type":"ds.search","options":{"query":"| tstats `pihole_summariesonly` count from datamodel=Network_Resolution.DNS where host=\"$host_tok$\" sourcetype=pihole DNS.message_type=query earliest=-30d@d latest=now by _time, DNS.message_type, DNS.reply_code span=1h\n| `drop_dm_object_name(DNS)`\n| eval startTime=relative_time(now(), \"@d\")\n| eval series=if(_time>=startTime, \"today\",\"prior\")\n| timechart span=1h sum(count) by series\n| eval Hour=strftime(_time, \"%H\")\n| eval Hour_12=strftime(_time, \"%I %p\")\n| stats avg(prior) as \"Month Mean\", perc5(prior) as \"Lower Predict\", perc95(prior) as \"Upper Predict\", sum(today) as \"Queries Today\" by Hour, Hour_12\n| fields - Hour","queryParameters":{"earliest":"-4h@m","latest":"now"}},"name":"pihole_queries_over_time"},"ds_search_10":{"type":"ds.search","options":{"query":"| tstats `pihole_summariesonly` count from datamodel=Network_Resolution.DNS where host=\"$host_tok$\" sourcetype=pihole (DNS.message_type=query OR DNS.reply_code=\"Query Refused\") by _time, DNS.src, DNS.message_type, DNS.reply_code span=30m\n| `drop_dm_object_name(DNS)`\n| stats sparkline(sum(eval(if(message_type==\"Query\",'count',0)))) as Sparkline, sum(eval(if(message_type==\"Query\",'count',0))) as \"# of Queries\", sum(eval(if(reply_code==\"Query Refused\",'count',0))) as \"# of Blocked Queries\" by src\n| eval \"% Blocked\"=round(('# of Blocked Queries'/'# of Queries')*100, 0)\n| `pihole_enrich_hostname(src)`\n| rename src as \"Source IP\"\n| fields \"Source IP\", Hostname, Sparkline, \"# of Queries\", \"# of Blocked Queries\", \"% Blocked\"\n| sort limit=10 - \"# of Queries\"","queryParameters":{"earliest":"$global_time_tok.earliest$","latest":"$global_time_tok.latest$"}},"name":"pihole_top_sources"},"ds_search_11":{"type":"ds.search","options":{"query":"| tstats `pihole_summariesonly` prestats=t count from datamodel=Network_Resolution.DNS where host=\"$host_tok$\" sourcetype=pihole DNS.message_type=response DNS.reply_code=\"Query Refused\" by DNS.src, DNS.query\n| `drop_dm_object_name(DNS)`\n| `pihole_enrich_hostname(src)`\n| eval Host=coalesce(Hostname,src)\n| chart limit=0 count over query by Host\n| addtotals\n| sort 10 -Total\n| fields - Total\n| untable query src count\n| xyseries src query count\n| addtotals\n| sort 10 -Total\n| fields - Total\n| untable src query count\n| xyseries query src count","queryParameters":{"earliest":"$global_time_tok.earliest$","latest":"$global_time_tok.latest$"}},"name":"pihole_top_blocked"}},"defaults":{"dataSources":{"ds.search":{"options":{"queryParameters":{}}}}},"inputs":{"input_1":{"type":"input.timerange","title":"","options":{"token":"global_time_tok","defaultValue":"@d,now"}},"input_2":{"type":"input.dropdown","title":"Pi-hole Server","options":{"token":"host_tok","defaultValue":"*","items":[{"value":"*","label":"All"}]},"dataSources":{"primary":"ds_search_2"}}},"layout":{"type":"grid","options":{"submitButton":false,"height":690},"structure":[{"item":"viz_single_1","type":"block","position":{"x":0,"y":0,"w":363,"h":190}},{"item":"viz_chart_1","type":"block","position":{"x":0,"y":190,"w":1200,"h":250}},{"item":"viz_table_1","type":"block","position":{"x":0,"y":440,"w":600,"h":250}},{"item":"viz_single_2","type":"block","position":{"x":363,"y":0,"w":427,"h":190}},{"item":"viz_chart_2","type":"block","position":{"x":600,"y":440,"w":600,"h":250}},{"item":"viz_single_3","type":"block","position":{"x":790,"y":0,"w":410,"h":190}}],"globalInputs":["input_1","input_2"]},"description":"","title":"Pihole Overview Copy"}]]>
    </definition>
    <assets>
        <![CDATA[{}]]>
    </assets>
</dashboard>
