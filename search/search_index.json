{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":"Step 1 - Add-on<pre><code>    Install and configure Pihole DNS Add-on for Splunk\n</code></pre> <ul> <li>Complete logging requirements</li> <li>Install on Indexers, Search Heads</li> <li>Configure inputs on Forwarders</li> </ul> <p>See Documentation  View on Splunkbase</p> Step 2 - App<pre><code>    Install and configure Pihole DNS App for Splunk\n</code></pre> <p></p> <ul> <li>Install dependencies</li> <li>Install only on Search Head</li> <li>(recommended) Configure app</li> </ul> <p>See Documentation  View on Splunkbase</p>"},{"location":"landing-page/","title":"Pi-hole DNS App for Splunk (pihole_dns_app)","text":"<p>Disclaimer</p> <p>This Splunk app is not affiliated with Pi-hole\u00ae and is not sponsored or sanctioned by the Pi-hole\u00ae team. As such, the included documentation does not contain information on how to get started with the Pi-hole DNS server. Rather, this documentation serves as a guide to help visualize the data in Splunk. Please visit https://pi-hole.net for documentation on installing/configuring your own Pi-hole server.</p> <p>Pi-hole is and the Pi-hole logo are registered trademarks of Pi-hole LLC.</p> <p>Visualize your Pi-hole in Splunk! If you've landed on this app, it's probably because you are running your own super awesome Pi-hole\u00ae server. If not, check it out! https://pi-hole.net/</p> <p>This app works with the Pihole DNS Add-on add-on which provides the field extractions necessary for this app.</p>"},{"location":"landing-page/#key-features","title":"Key Features","text":"<ul> <li>Allows for easier troubleshooting of blocked queries.</li> <li>Prebuilt dashboards that allows you to drill-down to specific queries for further analysis.</li> <li>View daily trends and easily identify if queries are outside the month's norm.</li> <li>Test Regex filters before applying them on the Pi-hole server.</li> <li>View a list of all DHCP clients.</li> <li>Identify errors that may be a result of a misconfiguration.</li> <li>Check the DNS queries across all Pi-hole instances in a single place.</li> <li>View Allow and Deny filters setup across all Pi-hole servers.</li> <li>and more!</li> </ul>"},{"location":"landing-page/#assumptions","title":"Assumptions","text":"<p>This documentation assumes the following:</p> <ol> <li>You have a working Pi-hole server.</li> <li>You have a working Splunk environment.</li> <li>Basic understanding of Splunk and Pi-hole.</li> <li>The Pihole DNS Add-on for Splunk has been installed and configured.</li> </ol>"},{"location":"landing-page/#about","title":"About","text":"<p>See Release Notes for version specific information.</p> Info Description Version 2.2.3 - Splunkbase | GitHub Vendor Product Version Pi-hole\u00ae 5.x, FTL 5.x <p>Get Started</p>"},{"location":"getting-started/app-dependencies/","title":"App Dependencies","text":"<p>The following table describes the Apps that are needed to utilize the full capabilities of the app. Please install and configure these apps prior to deploying this app.</p> <p>Danger, Will Robinson</p> <p>Failure to install any of the below apps/add-ons will cause this app to not function as intended.</p> Splunkbase App Description Pihole DNS Add-on (TA-pihole_dns) Technical Add-on needed for Splunk to correctly parse the Pi-hole data. Splunk Common Information Model The Splunk CIM normalizes the data into datamodels which this app leverages for performance. Force Directed App for Splunk Visualization utilized in dashboards. Status Indicator - Custom Visualizatioin Visualization utilized in dashboards."},{"location":"getting-started/where-to-install/","title":"Where to Install","text":""},{"location":"getting-started/where-to-install/#standalone-deployments","title":"Standalone Deployments","text":"<p>Install this app to the single instance. For more information see Splunk Docs: Install add-on in a single-instance Splunk deployment</p>"},{"location":"getting-started/where-to-install/#distributed-deployments","title":"Distributed Deployments","text":"Splunk Instance type Supported Required Comments Search Heads Yes Yes Install this app on search heads. Indexers No No This app does not require installation on indexers. Heavy Forwarders No No There is no need to install this app on Heavy Forwarders. Universal Forwarders No No This app should not be installed on Universal Forwarders. <p>The installation steps for deploying Apps/add-ons in a distributed environment can be found at Splunk Docs: Install an add-on in a distributed Splunk deployment</p>"},{"location":"getting-started/configure/configure-dma/","title":"Data Model Acceleration","text":"<p>Optional Step</p> <p>Enabling Data model acceleration (DMA) will allow the searches to perform much more efficiently for larger datasets. If you run into issues with dashboards taking too long to load, data model acceleration will increase performance with a slight increase to resource usage. To learn more about data model acceleration see Splunk Docs: Accelerate data models.</p>"},{"location":"getting-started/configure/configure-dma/#enable-acceleration","title":"Enable Acceleration","text":"<p>Before enabling Data model acceleration, ensure your dns index has been allowed on the CIM add-on list of indexes. </p> <ol> <li>In Splunk web, Navigate to Apps &gt; Manage Apps. </li> <li>Find the App \"Splunk Common Information Model\" and click <code>set up</code> on the right side. </li> <li>Select the \"Network Resolution\" data model.</li> <li> <p>Enter the name of the index being used for the pihole data in the \"Indexes whitelist\" field. This will allow only the indexes listed to be accelerated. If you are ingesting DNS data into other indexes and also want them to be included in the acceleration, list them here as well.</p> Tip <p>To quickly identify which indexes are being used for this data model, the following query can be run:</p> <pre><code>| tstats count from datamodel=Network_Resolution.DNS where index=* by index\n</code></pre> </li> <li> <p>Once the appropriate indexes are listed, check the \"Accelerate\" box at the top and save.</p> </li> <li>The data model will begin to build. This may take some time depending on the size.</li> <li>Update the <code>pihole_summariesonly</code> macro to \"summariesonly=true\". Setting this will force the dashboards to use accelerated data only, optimizing the searches. see Update Macros in this documentation for more information.</li> </ol>"},{"location":"getting-started/configure/configure-enrichment/","title":"Configure Enrichment","text":"Optional Step <p>This app can automatically enrich IPs with hostnames populated from DHCP events. This step can be skipped if enrichment is not required.</p> <p>The steps to setup enrichment for this app utilize Splunk Lookups. For more information on lookups see Splunk Docs: About lookups.</p>"},{"location":"getting-started/configure/configure-enrichment/#pi-hole-dhcp-enrichment-configuration","title":"Pi-hole DHCP Enrichment Configuration","text":"<p>Note</p> <p>The following steps only apply if you are using your Pi-hole server as your DHCP server. If you are not using the Pi-hole as your DHCP server, see Alternative Enrichment Configuration.</p> <p>For the built-in DHCP hostname enrichment to work, there is a scheduled search that needs to be enabled (Disabled by default).</p> Search Name Description Default Schedule Pihole - DHCP Leases Lookup - Gen Recurring search to keep DHCP leases up to date. Runs Hourly <ol> <li>From Splunk Web, open the Pihole DNS App for Splunk.</li> <li>Navigate to Settings &gt; Searches, Reports, and Alerts.</li> <li>Ensure the \"App\" context is the Pihole DNS App for Splunk by using the dropdown.</li> <li>Set the \"Owner\" to \"all\"</li> <li>Enable by clicking \"Edit\" &gt; \"Enable\"</li> <li>Click \"Run\"</li> </ol> <p>Clicking Run will build the lookup for the first time. After that, the lookup will run hourly to keep the information up to date. The frequency that the search runs can be updated by the following:</p> <ol> <li>From the same screen, click Edit &gt; Edit Schedule.</li> <li>Update the schedule as needed.</li> </ol>"},{"location":"getting-started/configure/configure-enrichment/#alternative-enrichment-configuration","title":"Alternative Enrichment Configuration","text":""},{"location":"getting-started/configure/configure-enrichment/#static-lookup-file","title":"Static Lookup File","text":"<p>Using a static lookup file may be the simplest way to get started for enriching IPs with hostnames. The static list takes more to maintain but is easier to get started. If your environment utilizes static IPs or DHCP reservations, this option is the easiest choice.</p> <p>Note</p> <p>If you already have a lookup file to map IPs to hostnames, see Use an existing lookup file.</p>"},{"location":"getting-started/configure/configure-enrichment/#method-1-use-the-lookup-editor","title":"Method 1 - Use the Lookup Editor","text":"<p>Recommended</p> <p>The lookup editor may be the easiest way to create and mange lookups in Splunk. You can download and install the Lookup Editor from Splunkbase: Lookup Editor.</p> <p>Once installed, the lookup editor can be used to create a new CSV lookup.</p> <ol> <li>Open the Lookup Editor in Splunk Web.</li> <li>Click \"Create a New Lookup\" &gt; CSV lookup.</li> <li>Give the lookup a descriptive name.</li> <li>Choose which App context this lookup will be stored in (i.e. Search &amp; Reporting).</li> <li>Leave the \"User-only\" box unchecked. This will give the lookup the global scope permissions it needs.</li> <li> <p>Create column headers (row 1). This app uses the following for the CSV header, however, any field names can be used.</p> Recomended Headers<pre><code>dest_nt_host,dest_ip,dest_mac\n</code></pre> </li> <li> <p>Populate the remaining rows with the IP and host information.</p> </li> <li>Once saved, move on to Update Lookup Macros.</li> </ol>"},{"location":"getting-started/configure/configure-enrichment/#method-2-create-and-upload-a-new-csv-file","title":"Method 2 - Create and Upload a new CSV file","text":"<p>A lookup file can be created outside of Splunk and then uploaded via the web interface.</p> <ol> <li>Use an editor to create a file in CSV format.</li> <li> <p>Create column headers (row 1). This app uses the following for the CSV header, however, any field names can be used.</p> Recomended Headers<pre><code>dest_nt_host,dest_ip,dest_mac\n</code></pre> </li> <li> <p>Populate the remaining rows with the IP and host information.</p> </li> <li>Be sure to save the file with a <code>.csv</code> extension.</li> <li>Open Splunk Web.</li> <li>Navigate to Settings &gt; Lookups &gt; Lookup table files (click \"+ Add new\")</li> <li>Select the Destination App (i.e. Search &amp; Reporting).</li> <li>Upload the file.</li> <li>Provide the Destination filename. This can be the same name as the one created (i.e. pihole_lookup.csv).</li> <li>Once saved, Navigate back to Settings &gt; Lookups &gt; Lookup table files, if you are not already there.</li> <li>Search for the name of the file you just uploaded.</li> <li>Modify the permissions for the file by clicking \"Permissions.\"</li> <li>Select \"All apps (system)\" from the two radio options.</li> <li>Check \"Read\" permissions for Everyone. Write permissions can be given as needed (typically set to admin &amp; power).</li> <li>After saving, move to Update Lookup Macros.</li> </ol>"},{"location":"getting-started/configure/configure-enrichment/#use-an-existing-lookup-file","title":"Use an existing lookup file","text":"<p>If you already have an existing lookup file that contains a mapping of hostnames and IPs, ensure the following:</p> <ol> <li>The lookup file has a global scope.</li> <li>Users are able to read the lookup file.</li> <li>If you are using a lookup file and a lookup definition, also ensure the lookup definition has the same permissions as above.</li> </ol> <p>Once verified the correct permissions are set, see Update Lookup Macros.</p>"},{"location":"getting-started/configure/configure-macros/","title":"Update Search Macros","text":"<p>Recommended Step</p> <p>To ensure this App functions efficiently, it is important to update a few search macros. Change the following macros to their appropriate values. For more information on the search macros used in this app, see Search Macros Reference.</p>"},{"location":"getting-started/configure/configure-macros/#how-to-update-macros","title":"How to Update Macros","text":"<ol> <li>Open the Pihole DNS app for Splunk.</li> <li> <p>Navigate to Settings &gt; Advanced Search &gt; Search macros.</p> Not seeing any results <p>If no results are found, be sure that the \"App\" context is set to the Pihole DNS app, owner is set to \"Any\", and choose \"Created in the App\" from the remaining drop-down.</p> </li> <li> <p>Update the search macros as necessary.</p> </li> </ol>"},{"location":"getting-started/configure/configure-macros/#update-index-macros","title":"Update Index Macros","text":"<p>Update the index specific macros to the indexes being used for the Pi-hole data. Updating these to the correct values will increase performance of searches.</p> Macro Default Description Example Value pihole_index index=* Update to the specific index being used for the \"pihole\" sourcetype. <code>index=dns</code> pihole_dhcp_index `pihole_index` Update to the specific index being used for the \"pihole:dhcp\" sourcetype, if different from the main pihole index. <code>index=dhcp</code> pihole_blocklist_index `pihole_index` Update to the index set in the scripted input from the Pihole DNS Add-on. <code>index=dns_system</code> pihole_system_index `pihole_index` Update to the specific index being used for the \"pihole:system\" sourcetype created from the system summary events modular input. see Pihole Add-on: Modular Inputs. <code>index=dns_system</code> pihole_filter_index `pihole_index` Update to the specific index being used for the pihole:filters sourcetype created from the filters modular input. see Pihole Add-on: Modular Inputs. <code>index=dns_system</code>"},{"location":"getting-started/configure/configure-macros/#update-search-related-macros","title":"Update Search Related Macros","text":"<p>Update this search macro only if you are using DMA. see Configure Data Model Acceleration for more information.</p> <p>Warning</p> <p>Updating this macro to \"true\" without first enabling data model acceleration will cause the searches in dashboards to fail or have no results.</p> Macro Default Description Example Value pihole_summariesonly summariesonly=false Defaults to not using summarized data from the CIM. Set to \"true\" if using data model acceleration. <code>summariesonly=true</code>"},{"location":"getting-started/configure/configure-macros/#update-lookup-macros","title":"Update Lookup Macros","text":"<p>Update the following search macros if you are utilizing a custom lookup for hostname enrichment. If you are using the default lookup included in this app, do not modify the following. see Configure Enrichment for more information.</p> Macro Default Description Example Value pihole_host_lookup_name pihole_dhcp_lease_lookup Update to the name of the CSV file you are using. <code>my_pihole_lookup.csv</code> pihole_lookup_field_ip dest_ip Update only if you are not using the default field for IPs. <code>client_ip</code> pihole_lookup_field_hostname dest_nt_host Update only if you are not using the default field for hostnames <code>client_name</code> pihole_lookup_field_mac dest_mac Update only if you are not using the default field for mac addresses. <code>client_mac</code>"},{"location":"getting-started/configure/configure-macros/#troubleshooting","title":"Troubleshooting","text":"<p>After saving the search macros, navigate back to the Pihole DNS app and you should now see the \"Hostname\" field being populated. If not, see Troubleshooting Enrichment.</p>"},{"location":"getting-started/troubleshooting/troubleshoot-enrichment/","title":"Troubleshoot Enrichment","text":""},{"location":"getting-started/troubleshooting/troubleshoot-enrichment/#common-problems","title":"Common Problems","text":""},{"location":"getting-started/troubleshooting/troubleshoot-enrichment/#permission-issue","title":"Permission Issue","text":"<p>The most common problem with not seeing hostnames populated is that the permissions for the lookup file are not correct. Check the following.</p> <ol> <li>In Splunk Web, Navigate to Settings &gt; Lookups &gt; Lookup table files.</li> <li>Search for the name of your lookup file.</li> <li>Verify the permissions for the file by clicking \"Permissions.\"</li> <li>Be sure \"All apps (system)\" is selected.</li> <li>Be sure \"Read\" permissions is granted to Everyone.</li> </ol> <p>If you are utilizing a lookup definition, perform the same steps for the definition.</p>"},{"location":"getting-started/troubleshooting/troubleshoot-enrichment/#search-macro-definition","title":"Search Macro Definition","text":"<p>Check the modified lookup search macros for accuracy. It may be possible that there is a typo in the changed values. See Update Macros in this documentation for more information.</p>"},{"location":"reference/reference-macros/","title":"Search Macro Reference","text":"Macro Default Description pihole_index index=* Update to the specific index being used for the \"pihole\" sourcetype. pihole_dhcp_index `pihole_index` Update to the specific index being used for the \"pihole:dhcp\" sourcetype, if different from the main pihole index. pihole_blocklist_index `pihole_index` Update to the index set in the scripted input from the Pihole DNS Add-on. pihole_system_index `pihole_index` Update to the specific index being used for the \"pihole:system\" sourcetype created from the system summary events modular input. see Pihole Add-on: Modular Inputs. pihole_filter_index `pihole_index` Update to the specific index being used for the pihole:filters sourcetype created from the filters modular input. see Pihole Add-on: Modular Inputs. pihole_summariesonly summariesonly=false Defaults to not using summarized data from the CIM. Set to \"true\" if using data model acceleration. pihole_host_lookup_name pihole_dhcp_lease_lookup Default Lookup used to map IPs to hostnames. pihole_lookup_field_ip dest_ip Default ip field for the lookup to map IPs to hostnames. pihole_lookup_field_hostname dest_nt_hostname Default hostname field for the lookup to map IPs to hostnames. pihole_lookup_field_mac dest_mac Default mac field for the lookup to map IPs to hostnames. pihole_enrich_rename rename `pihole_lookup_field_hostname` as \"dest_nt_host\", `pihole_lookup_field_ip` as \"dest_ip\" Used by app to rename lookup fields. pihole_enrich_hostname(1) lookup `pihole_host_lookup_name` `pihole_lookup_field_ip` as \"$ip_field$\" OUTPUTNEW `pihole_lookup_field_hostname` as Hostname Used by app to enrich data with hostnames. pihole_enrich_blocklist(1) lookup pihole_blocklist_lookup domain as \"$domain_field$\" OUTPUTNEW blocklist Used by app to enrich data with blocklist used."},{"location":"reference/releases/","title":"Release notes for the Pi-hole app for Splunk","text":""},{"location":"reference/releases/#v223-june-3-2023","title":"v2.2.3 June 3, 2023","text":"Info Description Version 2.2.3 - See on Splunkbase Vendor Product Version Pi-hole\u00ae v5.x, FTL 5.x"},{"location":"reference/releases/#whats-changed","title":"What's Changed","text":"<ul> <li>Added <code>dvc</code> to DHCP lookups and searches by @mljdivemaster - #66</li> <li>Version 2.2.3 by @ZachChristensen28 - #70</li> </ul> <p>Full Changelog: v2.2.2...v2.2.3</p>"},{"location":"reference/releases/#known-issues","title":"Known issues","text":"<p>This version of the Pi-hole app for Splunk has the following known issues. If no issues appear here, no issues have been reported. Issues can be reported on the Pi-hole DNS app for Splunk's Github page.</p>"},{"location":"reference/releases/release-history/","title":"Release history for the Pi-hole DNS app for Splunk","text":"<p>The latest version of the Pi-hole DNS app for Splunk is version 2.2.3. See Release notes for the Pi-hole DNS app for Splunk of the latest version.</p>"},{"location":"reference/releases/release-history/#v222-jan-14-2022","title":"v2.2.2 Jan 14, 2022","text":""},{"location":"reference/releases/release-history/#new-features","title":"New Features","text":"<ul> <li>Updated search dashboard to allow filtering of pie charts based of query input.</li> <li>Deprecating all knowledge objects for blocklist activity. This feature will be brought back with v6 of Pi-hole.</li> <li>Added ability to search by host in dashboards.</li> <li>Transaction search dashboard will now show if the CNAME was blocked.</li> </ul>"},{"location":"reference/releases/release-history/#v221-june-7-2021","title":"v2.2.1 June 7, 2021","text":"<ul> <li>Fixed error in stats command error on Splunk version 8.2.0 - #38</li> <li>added version to dashboards to support jQuery v3.5</li> </ul>"},{"location":"reference/releases/release-history/#v220-may-12-2021","title":"v2.2.0 May 12, 2021","text":"<ul> <li>Fixed issue causing DNS search dashboard to not populate from a custom lookup -&gt; #35</li> <li>Made DHCP lookup simpiler and removed excess saved searches related to the DHCP lookup.</li> </ul>"},{"location":"reference/releases/release-history/#v219-april-28-2021","title":"v2.1.9 April 28, 2021","text":"<ul> <li>Added macro for filter index.</li> <li>Created new view \"Pihole Filters.\" This dashboard displays the regex and exact filters created in the Pi-hole server. This requires modular inputs to be setup on the Pihole DNS add-on. see Pihole Add-on: Modular Inputs for more information.</li> <li>Created new view \"Filter Tester.\" This dashboard will help test regex and exact filters before you implement them on the Pi-hole.</li> </ul>"},{"location":"reference/releases/release-history/#v218-feb-21-2021","title":"v2.1.8 Feb 21, 2021","text":"<ul> <li>Removed spaces from <code>pihole_summariesonly</code> search macro causing dashboards to have the error \"Error in 'tstats' command: Option '=' is invalid.\" (Introduced in Version 2.1.6) - #31</li> <li>Added ability to see which lists a blocked query belongs to. This requires version 1.2.8 or later of the Pihole DNS Add-on.</li> <li>Added Default value on Pihole Overview dashboard for API host selection.</li> </ul>"},{"location":"reference/releases/release-history/#v217-feb-20-2021","title":"v2.1.7 Feb 20, 2021","text":"<ul> <li>Added ability to see which lists a blocked query belongs to. This requires version 1.2.8 or later of the Pihole DNS Add-on.</li> <li>Added Default value on Pihole Overview dashboard for API host selection.</li> </ul>"},{"location":"reference/releases/release-history/#v216-jan-26-2021","title":"v2.1.6 Jan 26, 2021","text":"<ul> <li>Added dropdown on the Pihole DNS search dashboard populated by DHCP entries #18 (@mljdivemaster)</li> <li>Added ability to filter by Pi-hole in dashboards #17</li> <li>Added macro to control summary indexes when utilizing tstats</li> <li>Added Top Queries Allowed/Blocked by Source on the Pihole DNS search Dashboard</li> <li>Updated the Pihole DNS search dashboard table to reduce the amount of \"unknown\" values.</li> <li>Updated the Pihole Query Log dashboard table to reduce the amount of \"unknown\" values. Also, updated field names for clarity.</li> <li>Fixed Typos in token on the Pihole DNS search dashboard.</li> <li>Fixed search on the Pihole Transaction dashboard which prevented no information to display on the force directed panel.</li> </ul>"},{"location":"reference/releases/release-history/#v215-dec-21-2020","title":"v2.1.5 Dec 21, 2020","text":"<ul> <li>Updated Pihole Overview dashboard to include data from the modular input of the TA-pihole_dns add-on.</li> <li>Updated DHCP enrichment macro to be simpler.</li> </ul>"},{"location":"reference/releases/release-history/#v214-oct-31-2020","title":"v2.1.4 Oct 31, 2020","text":"<ul> <li>Incomplete eval statement on Query log dashboard causing the \"Host\" field to be missing.</li> <li>Missing \"Transaction ID\" field on Query log dashbaord</li> </ul>"},{"location":"reference/releases/release-history/#v213-sept-1-2020","title":"v2.1.3 Sept 1, 2020","text":"<ul> <li>Added DHCP Overview Dashboard.</li> <li>If DHCP is being used, IP address will be enriched with hostnames.</li> <li>Added select enhancements to dashboards.</li> <li>New requirement added for Status Indicator - Custom Visualization.</li> <li>New requirement for populating DHCP hostnames (if DHCP is being used).</li> </ul>"},{"location":"reference/releases/release-history/#v212-july-27-2020","title":"v2.1.2 July 27, 2020","text":"<ul> <li>Fixed broken Drilldown on DNS Search Dashboard.</li> </ul>"}]}