<dashboard version="2" theme="dark" hiddenElements="{&quot;hideEdit&quot;:false,&quot;hideOpenInSearch&quot;:false,&quot;hideExport&quot;:false}">
    <label>Pihole Query Log</label>
    <description></description>
    <definition>
        <![CDATA[{"visualizations":{"viz_chart_1":{"type":"splunk.pie","dataSources":{"primary":"ds_search_2"},"eventHandlers":[{"type":"drilldown.linkToDashboard","options":{"app":"pihole_dns_app","dashboard":"pihole_dns_search","tokens":[{"token":"form.query","value":"$click.value$"},{"token":"form.reply_code","value":"No Error"},{"token":"form.message_type","value":"Response"}],"newTab":true}}],"title":"Top Queries Allowed","options":{},"context":{}},"viz_chart_2":{"type":"splunk.pie","dataSources":{"primary":"ds_search_3"},"eventHandlers":[{"type":"drilldown.linkToDashboard","options":{"app":"pihole_dns_app","dashboard":"pihole_dns_search","tokens":[{"token":"form.query","value":"$click.value$"},{"token":"form.message_type","value":"Response"},{"token":"form.reply_code","value":"Query Refused"}],"newTab":true}}],"title":"Top Queries Blocked","options":{},"context":{}},"viz_chart_3":{"type":"splunk.area","dataSources":{"primary":"ds_search_4"},"title":"Queries by Source over Time","options":{"yAxisAbbreviation":"off","y2AxisAbbreviation":"off","showRoundedY2AxisLabels":false,"legendTruncation":"ellipsisMiddle","showY2MajorGridLines":true,"xAxisTitleVisibility":"hide","yAxisScale":"linear","nullValueDisplay":"zero","stackMode":"auto","showSplitSeries":0,"legendMode":"standard","legendDisplay":"bottom","seriesColors":"[0xD93240,0x03588C,0xD9B607,0xA66D05,0xBF0404,0xF20544,0xCEB3F2,0x044BD9,0xB0BF39,0xF28705]"},"context":{}},"viz_chart_4":{"type":"splunk.area","dataSources":{"primary":"ds_search_5"},"title":"Blocked Queryies by Source over Time","options":{"yAxisAbbreviation":"off","y2AxisAbbreviation":"off","showRoundedY2AxisLabels":false,"legendTruncation":"ellipsisMiddle","showY2MajorGridLines":true,"xAxisTitleVisibility":"hide","nullValueDisplay":"zero","legendDisplay":"bottom","seriesColors":"[0xD93240,0x03588C,0xD9B607,0xA66D05,0xBF0404,0xF20544,0xCEB3F2,0x044BD9,0xB0BF39,0xF28705]"},"context":{}},"viz_table_1":{"type":"splunk.table","options":{"count":10,"dataOverlayMode":"none","percentagesRow":false,"rowNumbers":false,"totalsRow":false,"wrap":true,"drilldown":"cell"},"dataSources":{"primary":"ds_search_6"},"eventHandlers":[{"type":"drilldown.linkToDashboard","options":{"app":"pihole_dns_app","dashboard":"pihole_transaction_search","tokens":[{"token":"form.txn","value":"$row.Transaction_ID$"}],"newTab":true}}]}},"dataSources":{"ds_search_1":{"type":"ds.search","options":{"query":"| tstats `pihole_summariesonly` count where `pihole_index` sourcetype=pihole by host","queryParameters":{"earliest":"$global_time_tok.earliest$","latest":"$global_time_tok.latest$"}}},"ds_search_2":{"type":"ds.search","options":{"query":"| tstats `pihole_summariesonly` count from datamodel=Network_Resolution.DNS where sourcetype=pihole DNS.message_type=response DNS.reply_code=\"No Error\" host=\"$host_tok$\" by DNS.query\n| `drop_dm_object_name(DNS)`\n| sort 10 -count","queryParameters":{"earliest":"$global_time_tok.earliest$","latest":"$global_time_tok.latest$"}},"name":"pihole_queries_allowed"},"ds_search_3":{"type":"ds.search","options":{"query":"| tstats `pihole_summariesonly` count from datamodel=Network_Resolution.DNS where sourcetype=pihole DNS.message_type=response DNS.reply_code=\"Query Refused\" host=\"$host_tok$\" by DNS.query\n| `drop_dm_object_name(DNS)`\n| sort 10 -count","queryParameters":{"earliest":"$global_time_tok.earliest$","latest":"$global_time_tok.latest$"}},"name":"pihole_queries_blocked"},"ds_search_4":{"type":"ds.search","options":{"query":"| tstats `pihole_summariesonly` prestats=t count from datamodel=Network_Resolution.DNS where sourcetype=pihole DNS.message_type=query host=\"$host_tok$\" by _time, DNS.src\n| `drop_dm_object_name(DNS)`\n| `pihole_enrich_hostname(src)`\n| eval Host=coalesce(Hostname,src)\n| timechart useother=f count by Host","queryParameters":{"earliest":"$global_time_tok.earliest$","latest":"$global_time_tok.latest$"}},"name":"pihole_queries_by_source"},"ds_search_5":{"type":"ds.search","options":{"query":"| tstats `pihole_summariesonly` prestats=t count from datamodel=Network_Resolution.DNS where sourcetype=pihole DNS.message_type=response DNS.reply_code=\"Query Refused\" host=\"$host_tok$\" by _time, DNS.src\n| `drop_dm_object_name(DNS)`\n| `pihole_enrich_hostname(src)`\n| eval Host=coalesce(Hostname,src)\n| timechart useother=f count by Host","queryParameters":{"earliest":"$global_time_tok.earliest$","latest":"$global_time_tok.latest$"}},"name":"pihole_blocked_queries_over_time"},"ds_search_6":{"type":"ds.search","options":{"query":"| tstats `pihole_summariesonly` max(_time) as Time, latest(DNS.dest) as dest, values(DNS.message_type) as \"Message Type\", values(DNS.record_type) as \"Query Type\", latest(DNS.answer) as Answer, latest(DNS.reply_code) as \"Reply Code\" from datamodel=Network_Resolution.DNS where sourcetype=pihole DNS.query!=\"unknown\" host=\"$host_tok$\" by DNS.transaction_id, DNS.query, DNS.src\n| `drop_dm_object_name(DNS)`\n| `pihole_enrich_hostname(src)`\n| eval Source=coalesce(Hostname,src)\n| eval Answer=if('Reply Code'==\"Query Refused\",\"Pi-Holed!\",Answer)\n| eval \"Forwarded Destination\"=if(dest==\"unknown\", \"Not Forwarded\", dest)\n| sort - Time\n| convert timeformat=\"%c\" ctime(Time)\n| rename query as Query, transaction_id as \"Transaction_ID\"\n| fields Time, Query, Source, \"Forwarded Destination\", \"Message Type\", \"Query Type\", Answer, \"Reply Code\", \"Transaction_ID\"","queryParameters":{"earliest":"$global_time_tok.earliest$","latest":"$global_time_tok.latest$"}},"name":"pihole_details"}},"defaults":{"dataSources":{"ds.search":{"options":{"queryParameters":{}}}}},"inputs":{"input_1":{"type":"input.timerange","title":"","options":{"token":"global_time_tok","defaultValue":"-60m@m,now"}},"input_2":{"type":"input.dropdown","title":"Pi-hole Server","options":{"token":"host_tok","defaultValue":"*","items":[{"value":"*","label":"All"}]},"dataSources":{"primary":"ds_search_1"}}},"layout":{"type":"grid","options":{"submitButton":false,"height":750},"structure":[{"item":"viz_chart_1","type":"block","position":{"x":0,"y":0,"w":600,"h":250}},{"item":"viz_chart_2","type":"block","position":{"x":600,"y":0,"w":600,"h":250}},{"item":"viz_chart_3","type":"block","position":{"x":0,"y":250,"w":600,"h":250}},{"item":"viz_chart_4","type":"block","position":{"x":600,"y":250,"w":600,"h":250}},{"item":"viz_table_1","type":"block","position":{"x":0,"y":500,"w":1200,"h":250}}],"globalInputs":["input_1","input_2"]},"description":"","title":"Pihole Query Log Copy"}]]>
    </definition>
    <assets>
        <![CDATA[{}]]>
    </assets>
</dashboard>
